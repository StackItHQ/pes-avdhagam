function onEdit(e) {
  if (!e || !e.source || !e.range) {
    console.error('Event object is missing properties.');
    return;
  }

  // Get the active spreadsheet
  var spreadsheet = e.source;
  
  // Get the edited cell
  var range = e.range;
  
  // Get information about the edit
  var sheetName = range.getSheet().getName();
  var row = range.getRow();
  var column = range.getColumn();
  var oldValue = e.oldValue || '(empty)';
  var newValue = range.getValue();
  
  // Create a log message with a unique timestamp
  var logMessage = Utilities.formatString(
    "Timestamp: %s - Edit made in sheet '%s' at cell %s%s. Old value: '%s', New value: '%s'",
    new Date().toISOString(),  // Use ISO string for unique timestamp
    sheetName,
    columnToLetter(column),
    row,
    oldValue,
    newValue
  );
  
  // Log the edit
  console.log(logMessage);
  
  // Log to a separate sheet
  logToSheet(spreadsheet, logMessage);
  
  // Send data to your backend server
  var payload = {
    sheetName: sheetName,
    row: row,
    column: column,
    oldValue: oldValue,
    newValue: newValue
  };
  
  var options = {
    method: 'POST',
    contentType: 'application/json',
    payload: JSON.stringify(payload)
  };

  // Replace with your actual backend URL
  var backendUrl = 'https://9b06-49-207-192-109.ngrok-free.app/api/update'; 
  
  try {
    var response = UrlFetchApp.fetch(backendUrl, options);
    Logger.log('Response from backend: ' + response.getContentText());
  } catch (error) {
    console.error('Error sending data to backend: ' + error.message);
  }
}

// Helper function to convert column number to letter
function columnToLetter(column) {
  var temp, letter = '';
  while (column > 0) {
    temp = (column - 1) % 26;
    letter = String.fromCharCode(temp + 65) + letter;
    column = (column - temp - 1) / 26;
  }
  return letter;
}

// Function to log messages to a separate sheet
function logToSheet(spreadsheet, message) {
  var logSheet = spreadsheet.getSheetByName("Edit Logs");
  
  // Create the log sheet if it doesn't exist
  if (!logSheet) {
    logSheet = spreadsheet.insertSheet("Edit Logs");
    logSheet.appendRow(["Timestamp", "Edit Log"]);
  }
  
  // Append the new log entry
  logSheet.appendRow([new Date(), message]);
  Logger.log(message);
}





